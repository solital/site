<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="robots" content="index, follow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Schedule - Solital Framework 4.x</title>
  <link rel="shortcut icon" href="../img/favicon.ico">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="../css/reset.css">
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/sidebar.css">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/styles/default.css">
  <link rel="stylesheet" href="../css/styles/tomorrow-night-blue.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

  

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script src="../js/bootstrap.bundle.min.js"></script>
  <script src="../js/highlight.min.js"></script>
  <script src="../js/scripts.js"></script>
  <script src="../js/php.min.js"></script>
  <script src="../js/php-template.min.js"></script>
  <script src="../js/bash.min.js"></script>
  <script src="../js/yaml.min.js"></script>
  <script>hljs.highlightAll();</script>

  
  

  
    <script src="../search/main.js"></script>
  

  

</head>

<body>
  <div class="dashboard">
    <div class="dashboard-nav">
      <header class="mb-4">
        <a href="#!" class="menu-toggle">
          <i class="fas fa-bars"></i>
        </a>

        <a href="https://solital.github.io/site/" class="brand-logo">
          <img src="../img/solital-logo-2-sm-trans-2.png" alt="Solital Framework">
        </a>
      </header>

      <nav class="dashboard-nav-list">
        
        
  <a href=".." class="dashboard-nav-item ">
    Starting
  </a>

        
        
<div class="dashboard-nav-dropdown">
  <a href="#!" class="dashboard-nav-item dashboard-nav-dropdown-toggle ">
    Upgrade
  </a>

  <div class="dashboard-nav-dropdown-menu">
    
      <a href="https://github.com/solital/core/releases" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Release Notes
      </a>
    
      <a href="../upgrade-guide/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Upgrade Guide
      </a>
    
  </div>
</div>

        
        
<div class="dashboard-nav-dropdown">
  <a href="#!" class="dashboard-nav-item dashboard-nav-dropdown-toggle ">
    Settings
  </a>

  <div class="dashboard-nav-dropdown-menu">
    
      <a href="../environment-variables/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Environment Variables
      </a>
    
      <a href="../yaml-files/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> YAML Files
      </a>
    
      <a href="../helpers/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Helpers
      </a>
    
      <a href="../exceptions/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Exceptions
      </a>
    
      <a href="../application-api/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> API Application
      </a>
    
  </div>
</div>

        
        
<div class="dashboard-nav-dropdown">
  <a href="#!" class="dashboard-nav-item dashboard-nav-dropdown-toggle ">
    Routers
  </a>

  <div class="dashboard-nav-dropdown-menu">
    
      <a href="../routes/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Routes
      </a>
    
      <a href="../middleware/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Middleware
      </a>
    
      <a href="../url/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> URL
      </a>
    
      <a href="../events/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Events
      </a>
    
      <a href="../input-and-params/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Input and params
      </a>
    
  </div>
</div>

        
        
<div class="dashboard-nav-dropdown">
  <a href="#!" class="dashboard-nav-item dashboard-nav-dropdown-toggle active ">
    Components
  </a>

  <div class="dashboard-nav-dropdown-menu">
    
      <a href="../vinci-console/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Vinci Console
      </a>
    
      <a href="../cache/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Cache
      </a>
    
      <a href="../controller-model/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Controllers and Models
      </a>
    
      <a href="../date-and-time/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Date and time
      </a>
    
      <a href="../dependency-container/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Dependency Container
      </a>
    
      <a href="../event-loop/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Event Loop
      </a>
    
      <a href="../http-client/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> HTTP Client
      </a>
    
      <a href="../mailer-component/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Mailer
      </a>
    
      <a href="./" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Task Schedule
      </a>
    
      <a href="../wolf-template/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Wolf Template
      </a>
    
  </div>
</div>

        
        
<div class="dashboard-nav-dropdown">
  <a href="#!" class="dashboard-nav-item dashboard-nav-dropdown-toggle ">
    Resources
  </a>

  <div class="dashboard-nav-dropdown-menu">
    
      <a href="../browser-storage/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Browser Storage
      </a>
    
      <a href="../cookie/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Cookie
      </a>
    
      <a href="../collection/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Collection
      </a>
    
      <a href="../file-system/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> File System
      </a>
    
      <a href="../json/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> JSON
      </a>
    
      <a href="../logger/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Logger
      </a>
    
      <a href="../messages/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Messages
      </a>
    
      <a href="../number/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Number
      </a>
    
      <a href="../queue/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Queue
      </a>
    
      <a href="../session/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Session
      </a>
    
      <a href="../string-manipulate/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Strings
      </a>
    
      <a href="../validation/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Validation
      </a>
    
      <a href="../mask/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Mask
      </a>
    
  </div>
</div>

        
        
<div class="dashboard-nav-dropdown">
  <a href="#!" class="dashboard-nav-item dashboard-nav-dropdown-toggle ">
    Security
  </a>

  <div class="dashboard-nav-dropdown-menu">
    
      <a href="../authenticate/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Authenticate
      </a>
    
      <a href="../authorization/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Authorization
      </a>
    
      <a href="../cryptography/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Cryptography
      </a>
    
      <a href="../csrf-protection/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> CSRF Protection
      </a>
    
      <a href="../secure-password/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Secure Password
      </a>
    
      <a href="../verify-domain/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Verify Domain
      </a>
    
      <a href="../recovery-password/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Recovery Password
      </a>
    
      <a href="../scanner/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Malware Scanner
      </a>
    
  </div>
</div>

        
        
<div class="dashboard-nav-dropdown">
  <a href="#!" class="dashboard-nav-item dashboard-nav-dropdown-toggle ">
    Database
  </a>

  <div class="dashboard-nav-dropdown-menu">
    
      <a href="../migrations/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Migrations
      </a>
    
      <a href="../seeders/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Seeders
      </a>
    
      <a href="../dump/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Dump
      </a>
    
      <a href="../katrina-orm/" class="dashboard-nav-dropdown-item text-black">
        <span class="text-danger" style="margin-right: 10px;">&#10140;</span> Katrina ORM
      </a>
    
  </div>
</div>

        
        
  <a href="../deploy/" class="dashboard-nav-item ">
    Deploy
  </a>

        
      </nav>
    </div>

    <div class="dashboard-app">
      <header class="dashboard-toolbar">
        <a href="#!" class="menu-toggle btn-menu"><i class="fas fa-bars"></i></a>
      </header>

      <div class="dashboard-content">
        <div class="container">

          <section class="container section">
            <div class="row">
              <div class="col-md-12 col-sm-12 w-100">
                <h1 class="mt-4 font-weight-normal title-page">Task Schedule</h1>
              </div>

              <div class="col-md-12 col-sm-12 mt-3">
                

                <ul class="ml-5 mb-5">
                  
                    <li id="bullet-item">
                      <a href="#introduction" class="menu-main-item">Introduction</a>
                    </li>
                  
                  
                    <li id="bullet-item">
                      <a href="#usage" class="menu-main-item">Usage</a>
                    </li>
                  
                    <li id="bullet-childern-item">
                      <a href="#schedule-structure" class="menu-children-item">Schedule Structure</a>
                    </li>
                  
                  
                    <li id="bullet-item">
                      <a href="#changing-the-time" class="menu-main-item">Changing the time</a>
                    </li>
                  
                    <li id="bullet-childern-item">
                      <a href="#using-time-property" class="menu-children-item">Using "$time" property</a>
                    </li>
                  
                    <li id="bullet-childern-item">
                      <a href="#using-attributes" class="menu-children-item">Using Attributes</a>
                    </li>
                  
                  
                    <li id="bullet-item">
                      <a href="#before-job-execution" class="menu-main-item">Before job execution</a>
                    </li>
                  
                  
                    <li id="bullet-item">
                      <a href="#after-job-execution" class="menu-main-item">After job execution</a>
                    </li>
                  
                  
                    <li id="bullet-item">
                      <a href="#using-a-schedule-in-development-mode" class="menu-main-item">Using a schedule in development mode</a>
                    </li>
                  
                  
                    <li id="bullet-item">
                      <a href="#using-a-schedule-in-production-mode" class="menu-main-item">Using a schedule in production mode</a>
                    </li>
                  
                    <li id="bullet-childern-item">
                      <a href="#linux" class="menu-children-item">Linux</a>
                    </li>
                  
                    <li id="bullet-childern-item">
                      <a href="#windows" class="menu-children-item">Windows</a>
                    </li>
                  
                  
                </ul>

                
                <h2 id="introduction">Introduction</h2>
<p>Task scheduling is a commonly used technique for automating tasks based on a schedule. Such tasks may include backing up databases, processing a queue, or creating system usage reports, as they are required to be repeated regularly over time, or even indefinitely. It is better to schedule such tasks and monitor them so they can run predictably in a timely fashion.</p>
<h2 id="usage">Usage</h2>
<p>First, you must analyze whether the <code>default_timezone</code> variable in the <code>bootstrap.yaml</code> file is configured correctly. Otherwise, the schedule may be executed incorrectly.</p>
<p>To create a Schedule class, you must execute the following command entering the class name:</p>
<pre><code class="language-bash">php vinci schedule UserSchedule
</code></pre>
<p>All schedules are stored in the <code>app/Schedule</code> folder.</p>
<h3 id="schedule-structure">Schedule Structure</h3>
<p>The standard structure of a schedule is as follows:</p>
<pre><code class="language-php">&lt;?php 

namespace Solital\Schedule;

use Solital\Core\Schedule\TaskSchedule;
use Solital\Core\Schedule\ScheduleInterface;

/**
 * @generated class generated using Vinci Console
 */
class UserSchedule extends TaskSchedule implements ScheduleInterface
{
    /**
     * Construct with schedule time
     */
    public function __construct()
    {
        $this-&gt;time = &quot;everyMinute&quot;;
    }

    /**
     * @return mixed
     */
    public function handle(): mixed
    {
        return $this;
    }
}
</code></pre>
<div class="alert alert-info mt-4" role="alert">
    <h6 class="fw-semibold">Since Solital Core 4.5.2, all schedules extend from the `TaskSchedule` class</h6>
</div>

<p>The code that will be executed must be inside the <code>handle</code> method.</p>
<h2 id="changing-the-time">Changing the time</h2>
<p>Solital allows you to set a time for each task to run. You can use the <code>$time</code> property or attributes.</p>
<h3 id="using-time-property">Using "$time" property</h3>
<p>To change the time that the schedule will run, you can change the <code>$time</code> property inside the constructor.</p>
<pre><code class="language-php">public function __construct()
{
    $this-&gt;time = &quot;everyMinute&quot;;
}
</code></pre>
<h3 id="using-attributes">Using Attributes</h3>
<div class="alert alert-info mt-4" role="alert">
    <h6 class="fw-semibold">This feature is available since Solital Core 4.5.2</h6>
</div>

<p>Using properties may seem too simple for some people. Using attributes, you gain the ability to define what time or on what days a task will be executed.</p>
<p>See an example below:</p>
<pre><code class="language-php">use Solital\Core\Schedule\Attribute\EveryMinute;
use Solital\Core\Schedule\TaskSchedule;
use Solital\Core\Schedule\ScheduleInterface;

#[EveryMinute()]
class EmailScheduler extends TaskSchedule implements ScheduleInterface
{
    public function handle(): mixed
    {    
        return $this;
    }
}
</code></pre>
<p>Unlike the <code>$time</code> property, you can change the time that schedules will run using the constructor attribute. You can see all the attributes available in the <a href="https://github.com/solital/core/tree/master/src/Schedule/Attribute">Github repository</a>.</p>
<div class="alert alert-info mt-4" role="alert">
    <h6 class="fw-semibold">If you use the `$time` property together with the attributes, the priority will be given to the attributes</h6>
</div>

<p>Solital makes use of the <a href="https://packagist.org/packages/peppeocchi/php-cron-scheduler">php-cron-scheduler</a> component to schedule tasks. Therefore, you can access the documentation for that component to see the available options.</p>
<p>To make things easier, you can use one of the options below:</p>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Option</th>
      <th scope="col">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><span class="cmd-vinci">everyMinute</span></td>
      <td>Run every minute</td>
    </tr>
    <tr>
      <td><span class="cmd-vinci">hourly</span></td>
      <td>Run once per hour</td>
    </tr>
    <tr>
      <td><span class="cmd-vinci">daily</span></td>
      <td>Run once per day</td>
    </tr>
    <tr>
      <td><span class="cmd-vinci">at('* * * * *')</span></td>
      <td>This method accepts any expression supported by <a target="_blank" href="https://github.com/dragonmantank/cron-expression">dragonmantank/cron-expression</a></td>
    </tr>
  </tbody>
</table>

<h2 id="before-job-execution">Before job execution</h2>
<p>In some cases you might want to run some code, if the job is due to run, before it's being executed. For example you might want to add a log entry, ping a url or anything else. To do so, you can call the before like the example below.</p>
<pre><code class="language-php">public function before()
{
    // This code will be executed before the `handle` method
}
</code></pre>
<h2 id="after-job-execution">After job execution</h2>
<p>Sometime you might wish to do something after a job runs. The then methods provides you the flexibility to do anything you want after the job execution. The output of the job will be injected to this function. For example you might want to add an entry to you logs, ping a url etc</p>
<pre><code class="language-php">public function after()
{
    // This code will be executed after the `handle` method
}
</code></pre>
<h2 id="using-a-schedule-in-development-mode">Using a schedule in development mode</h2>
<p>If you need to use the task schedule when developing your project, use the <code>php vinci schedule</code> command passing the <code>--work</code> option.</p>
<pre><code class="language-bash">php vinci schedule --work
</code></pre>
<p>When a schedule is executed, an output of that schedule is generated within the <code>app/Storage/schedules/</code> folder.</p>
<h2 id="using-a-schedule-in-production-mode">Using a schedule in production mode</h2>
<p>To run the task schedule in production mode, you must use the same command as above using the <code>--run</code> option. However, there are different ways to execute this command for each type of operating system.</p>
<h3 id="linux">Linux</h3>
<p>Add a new entry to your crontab to run <code>php vinci schedule</code> every minute.</p>
<pre><code>* * * * * cd /path-to-your-project &amp;&amp; php vinci schedule --run 1&gt;&gt; /dev/null 2&gt;&amp;1
</code></pre>
<p>That's it! Your scheduler is up and running, now you can add your jobs without worring anymore about the crontab.</p>
<h3 id="windows">Windows</h3>
<p><strong>Create a Scheduled Task</strong></p>
<ol>
<li>Open <em>Task Scheduler</em></li>
<li>Select <em>Create Task...</em></li>
<li>Give the task a name and description</li>
<li>To run the task in the background, select <em>Run whether the user is logged on or not</em> and check the <em>Hidden</em> checkbox.</li>
</ol>
<p><strong>Triggers</strong></p>
<ol>
<li>Create a new trigger.</li>
<li>Set the trigger to run <em>Daily</em> and recur every <code>1</code> days.</li>
<li>Set <em>Repeat task every</em> to <code>1 minutes</code>. <code>1 minutes</code> is not a selectable option. Simply select <code>5 minutes</code> from the dropdown and then manually edit.</li>
<li>Set <em>for a duration of:</em> to <code>Indefinitely</code>.</li>
<li>Ensure that <em>Enabled</em> is checked.</li>
</ol>
<p><strong>Actions</strong></p>
<ol>
<li>Create a new action.</li>
<li>Start php by entering the php binary location, such as <code>C:\php\php.exe</code></li>
<li>Set <em>Add arguments</em> field to <code>C:\{project-dir}\vinci schedule --run</code> (replace <code>{project-dir}</code> with appropriate path).</li>
</ol>
<p><strong>Settings</strong></p>
<ol>
<li>Check <em>Allow task to be run on demand</em>.</li>
<li>Check <em>Run task as soon as possible after a scheduled start is missed</em>.</li>
</ol>
<p><strong>Wrap-up</strong></p>
<ol>
<li>To ensure that the task is running, find the task in the <em>Task Scheduler Library</em>.</li>
<li>Note the task <em>Status</em>. It may be <em>Ready</em> or <em>Running</em>.</li>
<li>Note the <em>Next Run Time</em> and <em>Last Run Time</em> properties.</li>
</ol>
                

                <hr />

                
                <h3>What to see next?</h3>

                <section aria-label="breadcrumb" class="mt-4">
                  <ol class="breadcrumb">
                    
                      <li class="breadcrumb-item"><a href="../mailer-component/">&#8592; Mailer</a></li>
                    
                    
                      <li class="breadcrumb-item"><a href="../wolf-template/">Wolf Template &#8594;</a></li>
                    
                  </ol>
                </section>
                

              </div>

              <hr>

              <div class="row text-center mt-3">
                <div class="col-md-12 col-sm-12 ml-2">
                  Built with <a href="https://www.mkdocs.org">MkDocs</a>.
                </div>
              </div>
            </div>

            <!--
              MkDocs version      : 1.5.3
              Docs Build Date UTC : 2024-10-11 16:21:41.934441+00:00
              -->

          </section>
        </div>
      </div>
    </div>
  </div>
</body>

</html>